<div class="cyber-card bekleme-panel" data-aos="fade-up">
    <div style="width: 100%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="card-info">
                <h3 style="color: var(--warning);"><i class="fas fa-hourglass-half"></i> ARAÇ BEKLEME ANALİZİ</h3>
                <p>6 Saatlik periyotlar üzerinden otomatik hesaplama.</p>
            </div>
            <div id="periyot-badge" style="background: var(--danger); color: #fff; padding: 10px 20px; border-radius: 50px; font-weight: 900; font-size: 0.9rem; box-shadow: 0 0 20px rgba(255, 77, 77, 0.3);">
                0 BEKLEME
            </div>
        </div>

        <div class="timer-display">
            <div class="timer-unit"><span id="days">00</span><label>GÜN</label></div>
            <div class="timer-unit"><span id="hours">00</span><label>SAAT</label></div>
            <div class="timer-unit"><span id="minutes">00</span><label>DAKİKA</label></div>
            <div class="timer-unit"><span id="seconds">00</span><label>SANİYE</label></div>
        </div>

        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 0.8rem; color: #666;">SONRAKİ BEKLEME PERİYODUNA:</span>
            <span id="next-period-timer" style="color: var(--accent); font-weight: bold; font-family: monospace;">--:--:--</span>
        </div>
    </div>
</div>

<script>
    // ÖNEMLİ: startTime değişkenini aracın giriş yaptığı saat olarak ayarla. 
    // Örnek: Veritabanından gelen 'giris_saati' verisi buraya basılmalı.
    const vehicleEntryTime = new Date().getTime() - (13 * 60 * 60 * 1000); // Test için: 13 saat önce girmiş varsayalım

    function updateOperationalTimer() {
        const now = new Date().getTime();
        const diff = now - vehicleEntryTime;

        // Toplam Saat Hesaplama
        const totalHours = diff / (1000 * 60 * 60);
        
        // 6 SAATTE 1 BEKLEME HESABI
        const beklemeSayisi = Math.floor(totalHours / 6);
        
        // Görsel Sayaç Hesapları
        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);

        // Bir sonraki 6 saatlik periyoda kalan süre
        const remainingMs = ( (beklemeSayisi + 1) * 6 * 60 * 60 * 1000 ) - diff;
        const remH = Math.floor(remainingMs / (1000 * 60 * 60));
        const remM = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
        const remS = Math.floor((remainingMs % (1000 * 60)) / 1000);

        // Ekranı Güncelle
        document.getElementById("days").innerText = d.toString().padStart(2, '0');
        document.getElementById("hours").innerText = h.toString().padStart(2, '0');
        document.getElementById("minutes").innerText = m.toString().padStart(2, '0');
        document.getElementById("seconds").innerText = s.toString().padStart(2, '0');
        
        document.getElementById("periyot-badge").innerText = beklemeSayisi + " BEKLEME";
        document.getElementById("next-period-timer").innerText = 
            remH.toString().padStart(2, '0') + ":" + 
            remM.toString().padStart(2, '0') + ":" + 
            remS.toString().padStart(2, '0');
            
        // Eğer bekleme varsa rengi uyar (Warning)
        if (beklemeSayisi > 0) {
            document.getElementById("periyot-badge").style.background = "var(--danger)";
        } else {
            document.getElementById("periyot-badge").style.background = "#22c55e"; // Bekleme yoksa yeşil
        }
    }

    setInterval(updateOperationalTimer, 1000);
    updateOperationalTimer();
</script>
